# SRT Toolkit 项目需求清单

## 项目概述
SRT Toolkit 是一个功能强大的SRT字幕处理工具集，集成了字幕翻译、语音合成、视频处理等多种功能。本文档记录了当前需要实现和改进的功能需求。

## 当前需求列表

### 1. 更新模型调用逻辑，增加Ollama Cloud模型的调用能力

**需求描述**：
- 扩展现有的API配置，支持Ollama Cloud模型
- 实现与现有模型调用逻辑的兼容性
- 提供灵活的模型切换机制

**实现要点**：
- 在 [`consts.py`](e:/project/srt-translator/consts.py:1) 中的 `API_CONFIG` 添加Ollama Cloud配置
- 确保 [`srt_translator.py`](e:/project/srt-translator/srt_translator.py:1) 中的 `SFClient` 类能够正确处理Ollama Cloud的API调用
- 添加命令行参数支持选择Ollama Cloud模型

**潜在挑战**：
- Ollama Cloud API格式可能与现有API不同
- 需要处理不同的认证方式
- 可能需要调整错误处理逻辑

### 2. 解决SRT TTS语音合成中，当字幕语速过快时的处理逻辑问题

**需求描述**：
- 改进 [`srt_tts.py`](e:/project/srt-translator/srt_tts.py:1) 中的语速处理逻辑
- 当字幕语速过快时，确保语音合成能够正常工作
- 优化音频时长调整功能

**实现要点**：
- 改进 [`detect_optimal_speed()`](e:/project/srt-translator/srt_tts.py:132) 方法，更准确地检测最优语速
- 优化 [`adjust_audio_duration()`](e:/project/srt-translator/srt_tts.py:315) 方法，处理极端语速情况
- 考虑添加字幕拆分功能，当单句字幕过长时进行智能拆分

**潜在挑战**：
- 极端语速可能导致音频质量下降
- 需要平衡语速和可理解性
- 可能需要调整音频拼接逻辑

### 3. 添加一个利用Whisper来实现语音（视频）转字幕的工具

**需求描述**：
- 创建一个新的工具，使用OpenAI的Whisper模型将语音或视频转换为字幕
- 支持多种音频/视频格式输入
- 生成标准SRT格式字幕文件

**实现要点**：
- 创建新文件 `speech_to_srt.py`
- 使用OpenAI Whisper API或本地Whisper模型
- 实现音频/视频预处理功能
- 添加时间轴精确对齐功能
- 支持多语言识别和翻译

**潜在挑战**：
- Whisper API的调用限制和成本
- 长音频文件的处理
- 音频质量和识别准确度的平衡

### 4. 整合项目中的所有工具，形成一个WebUI集，以便进行分项目、分批次处理和管理

**需求描述**：
- 创建一个统一的Web界面，整合所有现有工具
- 实现项目管理功能，支持多项目并行处理
- 提供任务队列和批量处理能力
- 实现进度监控和日志查看功能

**实现要点**：
- 选择合适的Web框架（如Flask、FastAPI或Streamlit）
- 设计统一的前端界面
- 实现后端API，整合所有工具的功能
- 添加数据库支持，管理项目和任务
- 实现用户认证和权限管理（可选）
- 添加实时进度监控功能

**潜在挑战**：
- 现有CLI工具的Web化改造
- 长时间运行任务的状态管理
- 资源使用和并发控制
- 复杂工作流的可视化设计

## 优先级建议

1. **高优先级**：需求1 - 更新模型调用逻辑，增加Ollama Cloud支持
   - 相对简单实现，立即提升模型选择灵活性

2. **中优先级**：需求2 - 解决SRT TTS语速过快问题
   - 改进现有功能，提升用户体验

3. **中优先级**：需求3 - 添加Whisper语音转字幕工具
   - 扩展项目功能，完善工作流

4. **低优先级**：需求4 - 整合WebUI
   - 最复杂的功能，需要详细设计和规划

## 实现计划

### 第一阶段
- 更新模型调用逻辑，支持Ollama Cloud
- 改进SRT TTS的语速处理逻辑
- 创建详细的技术设计文档

### 第二阶段
- 实现Whisper语音转字幕工具
- 进行充分测试和优化

### 第三阶段
- 设计WebUI架构和界面
- 逐步实现各工具的Web化
- 添加项目管理和批量处理功能

## 注意事项

- 所有新功能应保持与现有代码的兼容性
- 需要更新文档和README
- 添加适当的错误处理和日志记录
- 考虑性能优化和资源使用
- 确保API密钥和敏感信息的安全（继续使用.gitignore保护）

## 更新日志

- 2025-01-17: 创建初始需求文档